{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020/05/30/table-of-contents/","result":{"data":{"site":{"siteMetadata":{"title":"bono blog","author":"bono","twitterUsername":"@blueshw"}},"markdownRemark":{"id":"6dd656ea-f337-59df-a152-7c06770496b7","excerpt":"글을 작성하면 자동으로 생성되는 목차(TOC)를 만들어 보자. 간략한 스펙은 아래와 같다. 글을 하단으로 스크롤 하면 Header의 위치에 맞게 하이라이트 됨 항목을 클릭하면 해당 Header의 위치로 이동 Header 단계(# ~ ####)에 따른…","html":"<p>글을 작성하면 자동으로 생성되는 목차(TOC)를 만들어 보자. 간략한 스펙은 아래와 같다.</p>\n<blockquote>\n<ul>\n<li>글을 하단으로 스크롤 하면 Header의 위치에 맞게 하이라이트 됨</li>\n<li>항목을 클릭하면 해당 Header의 위치로 이동</li>\n<li>Header 단계(# ~ ####)에 따른 depth 구분</li>\n</ul>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f81bbcd8b77106d6fbb31bae3a476ea/ab986/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXElEQVQoz3WS/VKDMBDEeQCrJRAoBAiE71KqTh074/u/15oLHkMV//hNyGWy7O3Fk0JBihSRnyEUCeLI7sMEwo8QiPgPe/Vtzfu43XGd33H//HK8vd4wna+7l3lPqzhG8I/SsdYsXpoUOMUZVKqRZxUyVYJqe+74ogxPSNMCSml3b/sjryobmKpFqRscX0Icnnw8H4T7ZtgJQ5GYfIBOW8ggWV26lsdhBlObHlXZ/bD8RBc1crU4L3LjHNHFsmhQZMZmnrkOV4dGd6irAYZEdGvdLmK0kmBpazSoSKYrTtCekTidEatgFhskUruQt21u4cAZukzOVaIfInGCTT6hSJYsAvH/U/kNx0ADJMhtGJzslOMS5HIrQAfE3jevlCe9Cm6Xz5ah9DPO4xVde7ZM6LsJQ3+xzOjtvm1Gt6+r3g2A22aRrXOvrUc3XYJsU+gctEOqtUYCD497kynzDSDcG9h+8DRlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"table of contents in gatsby js official web site\"\n        title=\"table of contents in gatsby js official web site\"\n        src=\"/static/0f81bbcd8b77106d6fbb31bae3a476ea/fcda8/0.png\"\n        srcset=\"/static/0f81bbcd8b77106d6fbb31bae3a476ea/12f09/0.png 148w,\n/static/0f81bbcd8b77106d6fbb31bae3a476ea/e4a3f/0.png 295w,\n/static/0f81bbcd8b77106d6fbb31bae3a476ea/fcda8/0.png 590w,\n/static/0f81bbcd8b77106d6fbb31bae3a476ea/efc66/0.png 885w,\n/static/0f81bbcd8b77106d6fbb31bae3a476ea/c83ae/0.png 1180w,\n/static/0f81bbcd8b77106d6fbb31bae3a476ea/ab986/0.png 2114w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p align=\"center\" style=\"font-style: italic; margin-top: -20px;\">\n  &#60; gatsby js 공식 웹사이트, 우측의 TABLE OF CONTENTS와 비슷하게 구현할 예정 &#62;\n</p>\n<h2 id=\"gatsby-transformer-remark-사용\" style=\"position:relative;\"><a href=\"#gatsby-transformer-remark-%EC%82%AC%EC%9A%A9\" aria-label=\"gatsby transformer remark 사용 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-transformer-remark 사용</h2>\n<p>gatsby 블로그에서 markdown 문서를 컴파일(HTML로)하는 라이브러리는 크게 두 가지다. 하나는 remark를 사용하는 <code class=\"language-text\">gatsby-transformer-remark</code>, 다른 하나는 jsx를 markdown에서 사용할 수 있게 해주는 <code class=\"language-text\">gatsby-plugin-mdx</code>다. 문서와 웹사이트 종류에 따라 둘 중 하나를 선택하면 된다. 또는 사이트 내 문서 종류에 따라 두 가지 컴파일러를 모두 사용할 수도 있다.</p>\n<p>그런데, TOC(Table of Contents)를 구현하는데, markdown 컴파일 이야기가 왜 필요할까?\n이유는 <code class=\"language-text\">mdx</code>와 <code class=\"language-text\">remark</code>를 사용할 때 각각 TOC 구현 방법이 다르기 때문이다.</p>\n<h3 id=\"gatsby-transformer-remark\" style=\"position:relative;\"><a href=\"#gatsby-transformer-remark\" aria-label=\"gatsby transformer remark permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-transformer-remark</h3>\n<p><a href=\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\">gatsby-transformer-remark</a>는 gatsby 블로그에서 사용하는 필수 라이브러리다(mdx를 사용한다면 없어도 되지만..). remark는 markdown 문서를 파싱해 HTML로 변환하는 일종의 컴파일러인데, 우리가 markdown문서를 작성하고 빌드(gatsby build 명령어)하면 remark가 markdown 문서를 HTML로 변환한다. </p>\n<h3 id=\"gatsby-plugin-mdx\" style=\"position:relative;\"><a href=\"#gatsby-plugin-mdx\" aria-label=\"gatsby plugin mdx permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-plugin-mdx</h3>\n<p><a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-mdx/?=mdx\">gatsby-plugin-mdx</a>를 사용하면, 마크다운 파일(.mdx 사용)에 리액트 컴포넌트를 import할 수 있다. 이전에도 import하는 방법은 있었지만, 복잡하고 사용하기 어려웠다. mdx를 사용하면 훨씬 간단히 리액트 컴포넌트를 가져와 쓸 수 있다. 그렇기 때문에 markdown에 그래프 같이 동적으로 변하는 리액트 컴포넌트를 넣을 때 유용하다.</p>\n<h2 id=\"tableofcontents-속성-remark-vs-mdx\" style=\"position:relative;\"><a href=\"#tableofcontents-%EC%86%8D%EC%84%B1-remark-vs-mdx\" aria-label=\"tableofcontents 속성 remark vs mdx permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>tableOfContents 속성 (remark vs mdx)</h2>\n<p>remark와 mdx 모두 <code class=\"language-text\">tableOfContents</code>를 기본 속성으로 가진다. 하지만, 결과 데이터는 서로 다르다. </p>\n<p>우선, remark를 사용하면 데이터가 <code class=\"language-text\">HTML text</code> 형태로 만들어진다. </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// graphQL (정확한 query는 아니다)</span>\n<span class=\"token punctuation\">{</span>\n  markdownRemark <span class=\"token punctuation\">{</span>\n    tableOfContents\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// result data</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"markdownRemark\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"tableOfContents\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;ul>\\n&lt;li>&lt;a href='#fragment1'>First Heading&lt;/a>&lt;/li>\\n&lt;li>&lt;a href='#fragment2'>Second Heading&lt;/a>&lt;/li>\\n&lt;/ul>\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>반면에 mdx를 사용하면 데이터가 <code class=\"language-text\">객체</code> 형태로 만들어진다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// graphQL (정확한 query는 아니다)</span>\n<span class=\"token punctuation\">{</span>\n  mdx <span class=\"token punctuation\">{</span>\n    tableOfContents\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// result data</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"mdx\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"tableOfContents\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"items\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#fragment1\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"First Heading\"</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#fragment2\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Second Heading\"</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>    \n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>text로 만들어진 데이터는 이미 HTML이 구현되어 있기 때문에 간단히 사용할 수 있다. HTML 코드를 그대로 붙여주면 완성되기 때문이다. 하지만, HTML 코드가 정해져 있기 때문에 수정하려면 추가작업이 필요하다. HTML text를 파싱해서 객체로 변환하는 과정을 추가로 구현해야 한다. 반면에, 데이터가 객체 형태라면 여러 가지 변형이 가능하다. 데이터가 구조화되어 있고 원하는 방식으로 자유롭게 표현할 수 있기 때문에, text보다 확장성이 뛰어나다. </p>\n<p>하지만, 내 블로그는 이미 remark 기반으로 작성하고 있다. mdx가 확실히 장점이 많다. 하지만, mdx를 사용하면 수정할 부분이 많아진다. markdown 문서, gatsby 설정 및 node 실행 파일, graphQL query, 그리고 일부 컴포넌트 코드도 수정해야 한다. TOC 구현 때문에 또다른 위험을 감수하고 싶지는 않았다. 그래서 이번에는 remark를 이용해 TOC를 구현하려 한다.</p>\n<h2 id=\"header에-링크를-삽입하기\" style=\"position:relative;\"><a href=\"#header%EC%97%90-%EB%A7%81%ED%81%AC%EB%A5%BC-%EC%82%BD%EC%9E%85%ED%95%98%EA%B8%B0\" aria-label=\"header에 링크를 삽입하기 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Header에 링크를 삽입하기</h2>\n<p>Header에 링크를 삽입하기 위해 <a href=\"https://www.gatsbyjs.org/packages/gatsby-remark-autolink-headers/\">gatsby-remark-autolink-headers</a> plugin을 설치하자</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save gatsby-remark-autolink-headers</code></pre></div>\n<p><code class=\"language-text\">gatsby-consfig.js</code> 파일에 plugin을 등록하자. 반드시 <code class=\"language-text\">gstsby-transformer-remark</code>의 plugins에 넣어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-remark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token operator\">...</span>\n          <span class=\"token punctuation\">{</span>\n            resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-remark-autolink-headers</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n            options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              className<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">anchor-header</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 이 class명으로 하이라이트 코드를 구현할 예정이므로 반드시 넣자.</span>\n              maintainCase<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 이 부분은 반드시 false로 하자. url이 대소문자를 구분하기 때문에 링크가 작동하지 않을 수 있다.</span>\n              removeAccents<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n              elements<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">h2</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'h3'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">h4</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 링크를 추가할 Header 종류 선택</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>설정은 간단하다. options의 각 항목에 대한 설명은 <a href=\"https://www.gatsbyjs.org/packages/gatsby-remark-autolink-headers/\">gatsby 공식 페이지</a>에서 확인하자.</p>\n<h2 id=\"toc-구현하기\" style=\"position:relative;\"><a href=\"#toc-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\" aria-label=\"toc 구현하기 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TOC 구현하기</h2>\n<p>post 템플릿에서 post 정보를 가져오는 graphQL query에 <code class=\"language-text\">tableOfContents</code> 항목을 추가하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query BlogPostBySlug($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      id\n      excerpt(truncate: true)\n      html\n      tableOfContents // 추가.\n      frontmatter {\n        title\n        date(formatString: \"YYYY-MM-DD\")\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이제, 컴포넌트에서 tableOfContents를 사용할 수 있다. 먼저 위치를 잡아주자. 본문 오른쪽에 고정되도록 <code class=\"language-text\">position: absolute</code>를 사용한다. <code class=\"language-text\">right</code> 값은 전체 창에서 우측 여백의 너비만큼 반대(음수)로 설정한다. 그래야 본문 우측에 고정으로 배치된다.\n(참고로 Box는 <a href=\"https://rebassjs.org/\">rebass</a>의 기본 컴포넌트다. div로 생각하면 된다)</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Box</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token punctuation\">{</span>isTOCVisible <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Box</span></span>\n      <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n        position<span class=\"token operator\">:</span> <span class=\"token string\">'absolute'</span><span class=\"token punctuation\">,</span>\n        top<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        height<span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\n        right<span class=\"token operator\">:</span> <span class=\"token string\">'calc((100vw - 720px) / 2 * (-1))'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TableOfContents</span></span>\n        <span class=\"token attr-name\">items</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>tocItems<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">currentHeaderUrl</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>currentHeaderUrl<span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Box</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n  </span><span class=\"token punctuation\">{</span>본문 코드<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Box</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>위치를 잡았으면, <code class=\"language-text\">TableOfContents</code> 컴포넌트를 구현하자. 이미 HTML 코드가 만들어져 있기 때문에 스타일을 위한 CSS 코드 위주로 작성한다.\n(코드가 길어지기 때문에 불필요한 코드는 삭제했다. 전체 파일은 <a href=\"https://github.com/blueshw/gatsby-blog/blob/master/src/components/tableOfContents.js\">github 저장소</a>에서 확인하자)</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Box</span></span>\n  <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>calc((100vw - 720px) / 2 - 50px)<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">sx</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 윈도우 너비가 1200px보다 작으면 TOC를 노출하지 않는다.</span>\n    display<span class=\"token operator\">:</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'@media screen and (min-width: 1200px)'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// sticky 속성을 사용해서 화면에 계속 머무르도록 한다</span>\n      <span class=\"token comment\">// sticky는 fixed와 static을 결합한 형태라고 생각하면 됨.</span>\n      position<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">sticky</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      display<span class=\"token operator\">:</span> <span class=\"token string\">'block'</span><span class=\"token punctuation\">,</span>\n      fontSize<span class=\"token operator\">:</span> <span class=\"token string\">'14px'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Box</span></span>\n    <span class=\"token attr-name\">dangerouslySetInnerHTML</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> __html<span class=\"token operator\">:</span> items <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">sx</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 낮은 depth가 더 안쪽으로 들어가도록 모든 ul에 marginLeft를 부여한다.</span>\n      <span class=\"token string\">'&amp; ul'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        marginLeft<span class=\"token operator\">:</span> <span class=\"token string\">'20px'</span><span class=\"token punctuation\">,</span> \n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// currentHeaderUrl 문자열이 href 속성에 포함된다면 아래 스타일을 부여한다. </span>\n      <span class=\"token comment\">// 현재 스크롤에 해당하는 Header를 하이라이트 하기 위함</span>\n      <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&amp; ul > li a[href*=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>currentHeaderUrl<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"]</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> \n        fontSize<span class=\"token operator\">:</span> <span class=\"token string\">'15px'</span><span class=\"token punctuation\">,</span>\n        color<span class=\"token operator\">:</span> <span class=\"token string\">'#333333'</span><span class=\"token punctuation\">,</span>\n        fontWeight<span class=\"token operator\">:</span> <span class=\"token string\">'600'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Box</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"toc에-효과를-부여하자\" style=\"position:relative;\"><a href=\"#toc%EC%97%90-%ED%9A%A8%EA%B3%BC%EB%A5%BC-%EB%B6%80%EC%97%AC%ED%95%98%EC%9E%90\" aria-label=\"toc에 효과를 부여하자 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TOC에 효과를 부여하자</h2>\n<p>TOC만 있어도 괜찮지만, 읽는 사람이 더 나은 경험을 할 수 있도록 효과를 부여하자. 현재 읽는 글의 위치에 따라 가장 가까운 Header가 하이라이트(highlight) 되도록 처리하자. 그리고 그 변화가 자연스럽도록 transition도 추가하자.</p>\n<p>가장 핵심이 되는 스크롤 이벤트 핸들러 함수는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleScroll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> aboveHeaderUrl<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 화면 바로 위쪽에 위치한 header</span>\n  <span class=\"token keyword\">const</span> currentOffsetY <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>pageYOffset<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> headerElements <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.anchor-header'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> elem <span class=\"token keyword\">of</span> headerElements<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> top <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> elem<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> elemTop <span class=\"token operator\">=</span> top <span class=\"token operator\">+</span> currentOffsetY<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> isLast <span class=\"token operator\">=</span> elem <span class=\"token operator\">===</span> headerElements<span class=\"token punctuation\">[</span>headerElements<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>currentOffsetY <span class=\"token operator\">&lt;</span> elemTop <span class=\"token operator\">-</span> <span class=\"token constant\">HEADER_OFFSET_Y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 기억해둔 aboveHeaderUrl이 있다면 바로 위 header와 현재 element 사이에 화면이 스크롤 되어 있다.</span>\n      aboveHeaderUrl <span class=\"token operator\">&amp;&amp;</span>\n        <span class=\"token function\">setCurrentHeaderUrl</span><span class=\"token punctuation\">(</span>aboveHeaderUrl<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">.</span>origin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// 기억해둔 aboveHeaderUrl이 없다면 첫번째 header다. </span>\n      <span class=\"token comment\">// 이때는 어떤 header도 active 하지 않은 상태다.</span>\n      <span class=\"token operator\">!</span>aboveHeaderUrl <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">setCurrentHeaderUrl</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 마지막 header면 다음 element가 없기 때문에 현재 header를 active header라 간주한다.</span>\n      isLast <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">setCurrentHeaderUrl</span><span class=\"token punctuation\">(</span>elem<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">.</span>origin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token operator\">!</span>isLast <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>aboveHeaderUrl <span class=\"token operator\">=</span> elem<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">.anchor-header</code> 클래스를 가진 모든 요소를 가져와 각 요소의 스크롤 위치를 체크한다. 만약 <code class=\"language-text\">window.pageYOffset</code>보다 크다면(지났다면) aboveHeaderUrl에 기억해둔다. 그리고 다음 element가 현재 위치 보다 아래에 있으면 기억해둔 aboveHeaderUrl이 <code class=\"language-text\">currentHeaderUrl(현재 active Header)</code>라 간주한다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>작업하는 데 생각보다 시간이 오래 걸렸다. 처음에는 mdx로 다 바꾸려고 생각했다. 하지만, 작업을 하다 보니 생각보다 수정할 코드가 많아져서 remark를 그대로 이용하기로 했다. 코드 수정이 너무 많아지면 다른 곳에 예상치 못한 버그가 발생할 수 있기 때문이다.</p>\n<h2 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h2>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-mdx/?=mdx\">gatsby-plugin-mdx</a></li>\n<li><a href=\"https://thelocalhost.blog/2020/02/13/smooth-scroll-toc-gatsby/\">Add a Table of Contents with Smooth scroll using Gatsby and MDX</a></li>\n<li><a href=\"https://tech.lezhin.com/2019/03/20/css-sticky\">sticky by 레진 기술블로그</a></li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/2020/05/30/table-of-contents/#gatsby-transformer-remark-%EC%82%AC%EC%9A%A9\">gatsby-transformer-remark 사용</a></p>\n<ul>\n<li><a href=\"/2020/05/30/table-of-contents/#gatsby-transformer-remark\">gatsby-transformer-remark</a></li>\n<li><a href=\"/2020/05/30/table-of-contents/#gatsby-plugin-mdx\">gatsby-plugin-mdx</a></li>\n</ul>\n</li>\n<li><a href=\"/2020/05/30/table-of-contents/#tableofcontents-%EC%86%8D%EC%84%B1-remark-vs-mdx\">tableOfContents 속성 (remark vs mdx)</a></li>\n<li><a href=\"/2020/05/30/table-of-contents/#header%EC%97%90-%EB%A7%81%ED%81%AC%EB%A5%BC-%EC%82%BD%EC%9E%85%ED%95%98%EA%B8%B0\">Header에 링크를 삽입하기</a></li>\n<li><a href=\"/2020/05/30/table-of-contents/#toc-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\">TOC 구현하기</a></li>\n<li><a href=\"/2020/05/30/table-of-contents/#toc%EC%97%90-%ED%9A%A8%EA%B3%BC%EB%A5%BC-%EB%B6%80%EC%97%AC%ED%95%98%EC%9E%90\">TOC에 효과를 부여하자</a></li>\n<li><a href=\"/2020/05/30/table-of-contents/#%EC%A0%95%EB%A6%AC\">정리</a></li>\n<li><a href=\"/2020/05/30/table-of-contents/#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></li>\n</ul>","frontmatter":{"title":"자동으로 생성되는 목차(TOC: Table of Contents) 만들기","date":"2020-05-31"}}},"pageContext":{"slug":"/2020/05/30/table-of-contents/","previous":{"fields":{"slug":"/2020/05/20/disqus-to-utterances/"},"frontmatter":{"title":"disqus를 버리자 (feat. utterances)","tags":["disqus","utterances","댓글","blog","구글 서치 콘솔","퍼포먼스"]}},"next":null}}}